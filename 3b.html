<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <title>Questão 3b - 3D Three.js</title>
    <style>
        body { background: #222; margin: 0; }
        canvas { display: block; margin: 0 auto; background: #222; }
    </style>
</head>
<body>
    <canvas id="canvas" width="800" height="600"></canvas>
    <script src="https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.min.js"></script>
    <script>
        // --- Código da animação 3D (igual ao seu 3b.js) ---
        const canvas = document.getElementById("canvas");

        // Cria o renderizador Three.js usando o canvas existente
        const renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
        renderer.setClearColor(0x222222);
        renderer.setSize(canvas.width, canvas.height);

        // Cena e câmera
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(45, canvas.width / canvas.height, 1, 1000);
        camera.position.set(0, 0, 400);
        camera.lookAt(0, 0, 0);

        // Luz
        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(0, 0, 400);
        scene.add(light);

        // Círculo maior (no plano XY rotacionado 60° em X)
        const R = 100, r = 25;
        const circleGeometry = new THREE.TorusGeometry(R, 0.5, 16, 100);
        const circleMaterial = new THREE.MeshBasicMaterial({ color: 0x555555 });
        const circle = new THREE.Mesh(circleGeometry, circleMaterial);
        circle.rotation.x = Math.PI / 3;
        scene.add(circle);

        // Quadrado circunscrito
        const squareGeometry = new THREE.BufferGeometry();
        const s = R * Math.sqrt(2);
        const squareVertices = new Float32Array([
            -s, -s, 0,
            s, -s, 0,
            s,  s, 0,
            -s,  s, 0,
            -s, -s, 0
        ]);
        squareGeometry.setAttribute('position', new THREE.BufferAttribute(squareVertices, 3));
        const squareMaterial = new THREE.LineBasicMaterial({ color: 0x3498db });
        const square = new THREE.Line(squareGeometry, squareMaterial);
        square.rotation.x = Math.PI / 3;
        scene.add(square);

        // Círculo menor (rolando)
        const smallCircleGeometry = new THREE.TorusGeometry(r, 0.5, 16, 60);
        const smallCircleMaterial = new THREE.MeshBasicMaterial({ color: 0xe67e22 });
        const smallCircle = new THREE.Mesh(smallCircleGeometry, smallCircleMaterial);
        scene.add(smallCircle);

        // Ponto fixo no círculo menor
        const pointGeometry = new THREE.SphereGeometry(6, 16, 16);
        const pointMaterial = new THREE.MeshBasicMaterial({ color: 0xc0392b });
        const point = new THREE.Mesh(pointGeometry, pointMaterial);
        smallCircle.add(point);
        point.position.y = -r;

        // Animação
        const periodo = 4; // segundos por volta
        const fps = 60;
        const totalFrames = periodo * fps;
        let frame = 0;

        function animate() {
            // Ângulo do centro do círculo menor ao redor do maior
            const t = frame / totalFrames;
            const angulo = t * 2 * Math.PI; // volta completa em 4s

            // Posição do centro do círculo menor
            const x = (R - r) * Math.cos(angulo);
            const y = (R - r) * Math.sin(angulo);
            const z = 0;

            // Aplica rotação do plano XY
            const rotX = Math.PI / 3;
            const y2 = y * Math.cos(rotX) - z * Math.sin(rotX);
            const z2 = y * Math.sin(rotX) + z * Math.cos(rotX);

            smallCircle.position.set(x, y2, z2);

            // Rolamento sem deslizar: Δθ_roda = - (R - r)/r * Δθ_centro
            const anguloRoda = -((R - r) / r) * angulo;
            smallCircle.rotation.z = angulo + Math.PI / 2; // Mantém perpendicular ao círculo maior
            smallCircle.rotation.x = rotX;
            smallCircle.rotation.y = anguloRoda;

            renderer.render(scene, camera);

            frame = (frame + 1) % totalFrames;
            requestAnimationFrame(animate);
        }

        animate();
    </script>
</body>
</html>