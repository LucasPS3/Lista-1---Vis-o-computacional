<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <title>Visão Computacional:Lista 1</title>
    <style>
        canvas {
            background: #222;
            display: block;
            margin: 0 auto;
        }
        
        .botoes {
            text-align: center;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <div class="botoes">
        <button onclick="iniciarBinarizacao()">Binarização</button>
        <button onclick="window.open('questoes/processamento.html', '_blank')">Contraste e Brilho</button>
        <button onclick="window.open('questoes/filtros.html', '_blank')">Filtros Box e Laplaciano</button>
        <button onclick="window.open('questoes/diferenca.html', '_blank')">Diferença Absoluta</button>
        <button onclick="window.open('questoes/histogramas.html', '_blank')">Análise de Histogramas P&B</button>
        <button onclick="window.open('questoes/histogramas_araras.html', '_blank')">Análise de Histogramas - Araras</button>
    </div>
    <canvas id="canvas" width="800" height="600"></canvas>

    <script>
        const canvas = document.getElementById("canvas");
        let animFrameIdRef = {
            id: null
        };

        function limparCanvas() {
            const ctx = canvas.getContext("2d");
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function pararAnimacao() {
            if (animFrameIdRef.id) {
                cancelAnimationFrame(animFrameIdRef.id);
                animFrameIdRef.id = null;
            }
            // Limpar elementos da binarização se existirem
            if (typeof window.cleanupBinarizacao === 'function') {
                window.cleanupBinarizacao();
                window.cleanupBinarizacao = null;
            }
        }


        function carregarScript(scriptName) {
            pararAnimacao();
            limparCanvas();
            // Remove script antigo se existir
            const oldScript = document.getElementById("scriptQuestao");
            if (oldScript) {
                oldScript.remove();
            }
            // Cria novo script
            const script = document.createElement("script");
            script.src = `questoes/${scriptName}.js`;
            script.id = "scriptQuestao";
            script.onload = function() {
                const funcName = `start${scriptName.charAt(0).toUpperCase() + scriptName.slice(1)}`;
                if (typeof window[funcName] === "function") {
                    const cleanup = window[funcName](canvas, animFrameIdRef);
                    if (cleanup) {
                        window[`cleanup${scriptName.charAt(0).toUpperCase() + scriptName.slice(1)}`] = cleanup;
                    }
                }
            };
            document.body.appendChild(script);
        }

        function iniciarBinarizacao() {
            carregarScript('binarizacao');
        }

        function iniciarContrasteBrilho() {
            carregarScript('contrast_brightness');
        }
        // Inicializa com a binarização por padrão
        iniciarBinarizacao();
    </script>
</body>

</html>